\hypertarget{classSMImp_1_1SmartMeter}{}\section{S\+M\+Imp\+:\+:Smart\+Meter Class Reference}
\label{classSMImp_1_1SmartMeter}\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}


Smart Meter protocol implementation.  




{\ttfamily \#include $<$Smart\+Meter.\+h$>$}

Inheritance diagram for S\+M\+Imp\+:\+:Smart\+Meter\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classSMImp_1_1SmartMeter}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classSMImp_1_1SmartMeter_ac677ae1800bcd36e4d599cf3e65463b4}{Smart\+Meter} (Integer, Crypto\+P\+P\+::\+S\+H\+A1 $\ast$)
\item 
\hyperlink{classSMImp_1_1SmartMeter_acadde39bc15942aae2dceb2b4c8c654f}{Smart\+Meter} (Integer, \+::\hyperlink{classSMAdapter}{S\+M\+Adapter} $\ast$)
\item 
\hyperlink{classSMImp_1_1SmartMeter_ae4e756ce74055472a69a0b93f7fd0810}{Smart\+Meter} (Integer)
\item 
virtual \hyperlink{classSMImp_1_1SmartMeter_ace2ebf8736cf495f30a2bc55b1706d73}{$\sim$\+Smart\+Meter} ()
\item 
void \hyperlink{classSMImp_1_1SmartMeter_a577ec9d3df97e40c63e15f3d2f1847af}{set\+H\+M\+A\+C\+Key} (Integer)
\item 
bool \hyperlink{classSMImp_1_1SmartMeter_a38dcb0b09d01582e1322c11638d98fbf}{generate\+Keys} (\hyperlink{structSMImp_1_1Payload}{Payload})
\item 
void \hyperlink{classSMImp_1_1SmartMeter_a4ac0d17fe970851c693d75efc4483094}{set\+Anon\+Id} (Integer)
\item 
Integer \hyperlink{classSMImp_1_1SmartMeter_ad8721f6b2058318e7acf1ce6afa0757d}{get\+Anon\+Id} ()
\item 
\hyperlink{structSMImp_1_1Packet}{Packet} $\ast$ \hyperlink{classSMImp_1_1SmartMeter_ab5248e75260fdd693fe0f5bb3238c249}{send\+Data\+To\+T\+TP} (Integer data)
\item 
\hyperlink{structSMImp_1_1Packet}{Packet} $\ast$ \hyperlink{classSMImp_1_1SmartMeter_a9511926a038ac3ac9c65013f7dd7fb2f}{session\+Key\+Exchange} (char $\ast$m, Integer l, Integer trusted\+Party\+Id, Integer trusted\+Party\+Key, Integer trusted\+Party\+Mu)
\item 
bool \hyperlink{classSMImp_1_1SmartMeter_a489f430377277201d687642d9a58ab80}{recieve\+H\+M\+AC} (Integer c1, Integer c2, Integer ttp\+Id)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Smart Meter protocol implementation. 

Most variables have been named after their respective names given in the original research paper available \href{https://www.researchgate.net/publication/305077004_Secure_and_efficient_protection_of_consumer_privacy_in_Advanced_Metering_Infrastructure_supporting_fine-grained_data_analysis}{\tt here}. See section 5 (Page 7) for the beginning of the protocol implementation. 

Definition at line 15 of file Smart\+Meter.\+h.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSMImp_1_1SmartMeter_ac677ae1800bcd36e4d599cf3e65463b4}\label{classSMImp_1_1SmartMeter_ac677ae1800bcd36e4d599cf3e65463b4}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!Smart\+Meter@{Smart\+Meter}}
\index{Smart\+Meter@{Smart\+Meter}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{Smart\+Meter()}{SmartMeter()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily S\+M\+Imp\+::\+Smart\+Meter\+::\+Smart\+Meter (\begin{DoxyParamCaption}\item[{Integer}]{,  }\item[{Crypto\+P\+P\+::\+S\+H\+A1 $\ast$}]{ }\end{DoxyParamCaption})}

\begin{DoxySeeAlso}{See also}
S\+M\+Imp\+::\+Requester\+::\+Requester(\+Integer,\+S\+H\+A1) 
\end{DoxySeeAlso}
\mbox{\Hypertarget{classSMImp_1_1SmartMeter_acadde39bc15942aae2dceb2b4c8c654f}\label{classSMImp_1_1SmartMeter_acadde39bc15942aae2dceb2b4c8c654f}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!Smart\+Meter@{Smart\+Meter}}
\index{Smart\+Meter@{Smart\+Meter}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{Smart\+Meter()}{SmartMeter()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily S\+M\+Imp\+::\+Smart\+Meter\+::\+Smart\+Meter (\begin{DoxyParamCaption}\item[{Integer}]{,  }\item[{\+::\hyperlink{classSMAdapter}{S\+M\+Adapter} $\ast$}]{ }\end{DoxyParamCaption})}

For debugging. \mbox{\Hypertarget{classSMImp_1_1SmartMeter_ae4e756ce74055472a69a0b93f7fd0810}\label{classSMImp_1_1SmartMeter_ae4e756ce74055472a69a0b93f7fd0810}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!Smart\+Meter@{Smart\+Meter}}
\index{Smart\+Meter@{Smart\+Meter}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{Smart\+Meter()}{SmartMeter()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily S\+M\+Imp\+::\+Smart\+Meter\+::\+Smart\+Meter (\begin{DoxyParamCaption}\item[{Integer}]{i }\end{DoxyParamCaption})}



Definition at line 34 of file Smart\+Meter.\+cc.



References S\+M\+Imp\+::\+Requester\+::\+Requester(), and Smart\+Meter().

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_ace2ebf8736cf495f30a2bc55b1706d73}\label{classSMImp_1_1SmartMeter_ace2ebf8736cf495f30a2bc55b1706d73}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!````~Smart\+Meter@{$\sim$\+Smart\+Meter}}
\index{````~Smart\+Meter@{$\sim$\+Smart\+Meter}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{$\sim$\+Smart\+Meter()}{~SmartMeter()}}
{\footnotesize\ttfamily S\+M\+Imp\+::\+Smart\+Meter\+::$\sim$\+Smart\+Meter (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Definition at line 49 of file Smart\+Meter.\+cc.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classSMImp_1_1SmartMeter_a38dcb0b09d01582e1322c11638d98fbf}\label{classSMImp_1_1SmartMeter_a38dcb0b09d01582e1322c11638d98fbf}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!generate\+Keys@{generate\+Keys}}
\index{generate\+Keys@{generate\+Keys}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{generate\+Keys()}{generateKeys()}}
{\footnotesize\ttfamily bool S\+M\+Imp\+::\+Smart\+Meter\+::generate\+Keys (\begin{DoxyParamCaption}\item[{\hyperlink{structSMImp_1_1Payload}{Payload}}]{pl }\end{DoxyParamCaption})}

Generates keys from payload given by Utility Company. 

Definition at line 11 of file Smart\+Meter.\+cc.



References S\+M\+Imp\+::\+Master\+Key\+::g, S\+M\+Imp\+::\+Requester\+::get\+Partials(), S\+M\+Imp\+::\+Requester\+::keys, S\+M\+Imp\+::\+Master\+Key\+::p, S\+M\+Imp\+::\+Requester\+::params, S\+M\+Imp\+::\+Key\+::piece, S\+M\+Imp\+::\+Key\+Pair\+::priv, S\+M\+Imp\+::\+Key\+Pair\+::pub, S\+M\+Imp\+::\+Master\+Key\+::q, and S\+M\+Imp\+::\+Requester\+::rng.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_ad8721f6b2058318e7acf1ce6afa0757d}\label{classSMImp_1_1SmartMeter_ad8721f6b2058318e7acf1ce6afa0757d}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!get\+Anon\+Id@{get\+Anon\+Id}}
\index{get\+Anon\+Id@{get\+Anon\+Id}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{get\+Anon\+Id()}{getAnonId()}}
{\footnotesize\ttfamily Integer S\+M\+Imp\+::\+Smart\+Meter\+::get\+Anon\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxySeeAlso}{See also}
S\+M\+Imp\+::\+Requester\+::get\+Anon\+Id() 
\end{DoxySeeAlso}


Definition at line 53 of file Smart\+Meter.\+cc.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_a489f430377277201d687642d9a58ab80}\label{classSMImp_1_1SmartMeter_a489f430377277201d687642d9a58ab80}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!recieve\+H\+M\+AC@{recieve\+H\+M\+AC}}
\index{recieve\+H\+M\+AC@{recieve\+H\+M\+AC}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{recieve\+H\+M\+A\+C()}{recieveHMAC()}}
{\footnotesize\ttfamily bool S\+M\+Imp\+::\+Smart\+Meter\+::recieve\+H\+M\+AC (\begin{DoxyParamCaption}\item[{Integer}]{c1,  }\item[{Integer}]{c2,  }\item[{Integer}]{ttp\+Id }\end{DoxyParamCaption})}

Used at the end of the session key exchange phase. H\+M\+AC verifies, then decrypts the final shared session key. 
\begin{DoxyParams}{Parameters}
{\em c1} & Part 1 of the encrypted session key. \\
\hline
{\em c2} & Part 2 of the encrypted session key. \\
\hline
{\em ttp\+Id} & ID of the Trusted Third Party. \\
\hline
\end{DoxyParams}


Definition at line 221 of file Smart\+Meter.\+cc.



References S\+M\+Adapter\+::add\+Sim\+Time(), S\+M\+Imp\+::\+Master\+Key\+::g, S\+M\+Imp\+::\+Requester\+::keys, S\+M\+Adapter\+::log(), S\+M\+Imp\+::\+Master\+Key\+::p, S\+M\+Imp\+::\+Requester\+::params, S\+M\+Imp\+::\+Key\+::partial, S\+M\+Imp\+::\+Key\+::piece, and S\+M\+Imp\+::\+Key\+Pair\+::priv.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_ab5248e75260fdd693fe0f5bb3238c249}\label{classSMImp_1_1SmartMeter_ab5248e75260fdd693fe0f5bb3238c249}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!send\+Data\+To\+T\+TP@{send\+Data\+To\+T\+TP}}
\index{send\+Data\+To\+T\+TP@{send\+Data\+To\+T\+TP}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{send\+Data\+To\+T\+T\+P()}{sendDataToTTP()}}
{\footnotesize\ttfamily \hyperlink{structSMImp_1_1Packet}{Packet} $\ast$ S\+M\+Imp\+::\+Smart\+Meter\+::send\+Data\+To\+T\+TP (\begin{DoxyParamCaption}\item[{Integer}]{data }\end{DoxyParamCaption})}

Encrypts data to be sent to the Trusted Thrid Party. 
\begin{DoxyParams}{Parameters}
{\em data} & Data to be encrypted and sent to Trusted Thrid Party. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\hyperlink{structSMImp_1_1Packet}{Packet} of encrypted data. 
\end{DoxyReturn}


Definition at line 69 of file Smart\+Meter.\+cc.



References S\+M\+Adapter\+::add\+Sim\+Time(), S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::c1, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::c2, D\+E\+B\+UG, S\+M\+Imp\+::\+Master\+Key\+::g, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::hmac, S\+M\+Imp\+::\+Requester\+::id, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::id, S\+M\+Adapter\+::log(), S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::message\+Length, S\+M\+Imp\+::\+Master\+Key\+::p, S\+M\+Imp\+::\+Requester\+::params, S\+M\+Imp\+::\+Packet\+::pl, S\+M\+Imp\+::\+Requester\+::R, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::r, S\+M\+Imp\+::\+Requester\+::shaone, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::time\+Stamp, and S\+M\+Imp\+::\+Master\+Key\+::x.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_a9511926a038ac3ac9c65013f7dd7fb2f}\label{classSMImp_1_1SmartMeter_a9511926a038ac3ac9c65013f7dd7fb2f}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!session\+Key\+Exchange@{session\+Key\+Exchange}}
\index{session\+Key\+Exchange@{session\+Key\+Exchange}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{session\+Key\+Exchange()}{sessionKeyExchange()}}
{\footnotesize\ttfamily \hyperlink{structSMImp_1_1Packet}{Packet} $\ast$ S\+M\+Imp\+::\+Smart\+Meter\+::session\+Key\+Exchange (\begin{DoxyParamCaption}\item[{char $\ast$}]{m,  }\item[{Integer}]{l,  }\item[{Integer}]{trusted\+Party\+Id,  }\item[{Integer}]{trusted\+Party\+Key,  }\item[{Integer}]{trusted\+Party\+Mu }\end{DoxyParamCaption})}

Performs all the processes to both generate and split up the session key, returning an array of packets to encasulate in the \hyperlink{classAdapter}{Adapter}. 
\begin{DoxyParams}{Parameters}
{\em m} & Message, or the session key to be generated, see S\+M\+Adaoter\+::start\+Session\+Key\+Exchange(omnetpp\+::c\+Message$\ast$ msg). \\
\hline
{\em l} & Length of the session key, does not need to be a multiple of 4 since char(\textquotesingle{}0\textquotesingle{})s (or int(48)) are padded to reach the desired length. \\
\hline
{\em trusted\+Party\+Id} & ID of the Trusted Third Party to share a session key with. \\
\hline
{\em trusted\+Party\+Key} & Missnamed variable, this is just the first piece of the public key -\/ specificially the component generated by the Utility Company. \\
\hline
{\em trusted\+Party\+Mu} & second peice of the public key, generated by the Trusted Third Party. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns array of messages to be encapsulated and sent to Trusted Third Party. Array is of length (l+(4-\/(l\%4)))/4, or ceiling(l/4) where l is the length of the session key. 
\end{DoxyReturn}


Definition at line 130 of file Smart\+Meter.\+cc.



References S\+M\+Adapter\+::add\+Sim\+Time(), S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::c1, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::c2, S\+M\+Imp\+::\+Packet\+::dest, S\+M\+Imp\+::\+Master\+Key\+::g, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::hmac, S\+M\+Imp\+::\+Requester\+::id, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::id, S\+M\+Adapter\+::log(), S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::message\+Length, S\+M\+Imp\+::\+Master\+Key\+::p, S\+M\+Imp\+::\+Requester\+::params, S\+M\+Imp\+::\+Packet\+::pl, S\+M\+Imp\+::\+Requester\+::R, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::r, S\+M\+Imp\+::\+Requester\+::rng, S\+M\+Imp\+::\+Requester\+::shaone, S\+M\+Imp\+::\+H\+M\+A\+C\+Payload\+::time\+Stamp, and S\+M\+Imp\+::\+Master\+Key\+::x.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_a4ac0d17fe970851c693d75efc4483094}\label{classSMImp_1_1SmartMeter_a4ac0d17fe970851c693d75efc4483094}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!set\+Anon\+Id@{set\+Anon\+Id}}
\index{set\+Anon\+Id@{set\+Anon\+Id}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{set\+Anon\+Id()}{setAnonId()}}
{\footnotesize\ttfamily void S\+M\+Imp\+::\+Smart\+Meter\+::set\+Anon\+Id (\begin{DoxyParamCaption}\item[{Integer}]{a }\end{DoxyParamCaption})}

Sets the anonymous ID 

Definition at line 58 of file Smart\+Meter.\+cc.

\mbox{\Hypertarget{classSMImp_1_1SmartMeter_a577ec9d3df97e40c63e15f3d2f1847af}\label{classSMImp_1_1SmartMeter_a577ec9d3df97e40c63e15f3d2f1847af}} 
\index{S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}!set\+H\+M\+A\+C\+Key@{set\+H\+M\+A\+C\+Key}}
\index{set\+H\+M\+A\+C\+Key@{set\+H\+M\+A\+C\+Key}!S\+M\+Imp\+::\+Smart\+Meter@{S\+M\+Imp\+::\+Smart\+Meter}}
\subsubsection{\texorpdfstring{set\+H\+M\+A\+C\+Key()}{setHMACKey()}}
{\footnotesize\ttfamily void S\+M\+Imp\+::\+Smart\+Meter\+::set\+H\+M\+A\+C\+Key (\begin{DoxyParamCaption}\item[{Integer}]{i }\end{DoxyParamCaption})}

Sets H\+M\+AC to be used for verification. 

Definition at line 63 of file Smart\+Meter.\+cc.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/crypto/\hyperlink{crypto_2SmartMeter_8h}{Smart\+Meter.\+h}\item 
src/crypto/\hyperlink{crypto_2SmartMeter_8cc}{Smart\+Meter.\+cc}\end{DoxyCompactItemize}
